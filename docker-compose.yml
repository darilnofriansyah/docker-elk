version: "3.8"
services:
    elasticsearch01:
      build:
        context: elasticsearch/
        args:
          ELK_VERSION: ${ELK_VERSION:-7.10.1}
      volumes:
        - type: bind
          source: ./elasticsearch/config/elasticsearch.yml
          target: /usr/share/elasticsearch/config/elasticsearch.yml
          read_only: true
      #- ${ELASTICSEARCH_DATA:-/data}/elasticsearch01:/usr/share/elasticsearch/data
      ports:
        - "9200:9200"
        - "9300:9300"
      environment:
        - node.name=elasticsearch01
        - discovery.seed_hosts=elasticsearch02
        - cluster.initial_master_nodes=elasticsearch01,elasticsearch02
        - bootstrap.memory_lock=true
        - "ES_JAVA_OPTS=-Xms256m -Xmx256m"
        - http.cors.enabled=true
        - http.cors.allow-origin="*"
        - http.cors.allow-methods=OPTIONS, HEAD, GET, POST, PUT, DELETE
        - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length
        - http.cors.allow-credentials=true
      ulimits:
        memlock:
          soft: -1
          hard: -1
    elasticsearch02:
      build:
        context: elasticsearch/
        args:
          ELK_VERSION: ${ELK_VERSION:-7.10.1}
      volumes:
        - type: bind
          source: ./elasticsearch/config/elasticsearch.yml
          target: /usr/share/elasticsearch/config/elasticsearch.yml
          read_only: true
        #- ${ELASTICSEARCH_DATA:-/data}/elasticsearch02:/usr/share/elasticsearch/data
      environment:
        - node.name=elasticsearch02
        - discovery.seed_hosts=elasticsearch01
        - cluster.initial_master_nodes=elasticsearch01,elasticsearch02
        - bootstrap.memory_lock=true
        - "ES_JAVA_OPTS=-Xms256m -Xmx256m"
        - http.cors.enabled=true
        - http.cors.allow-origin="*"
        - http.cors.allow-methods=OPTIONS, HEAD, GET, POST, PUT, DELETE
        - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length
        - http.cors.allow-credentials=true
      ulimits:
        memlock:
          soft: -1
          hard: -1
    kibana:
      build:
        context: kibana/
        args:
          ELK_VERSION: ${ELK_VERSION:-7.10.1}
      volumes:
        - type: bind
          source: ./kibana/config/kibana.yml
          target: /usr/share/kibana/config/kibana.yml
          read_only: true
      ports:
        - 5601:5601
      depends_on:
        - elasticsearch01
        - elasticsearch02
#    nginx:
#      build:
#        context: ./nginx
#      restart: always
#      ports:
#        - 80:80
#      volumes:
#        - ./nginx/nginx.conf:/etc/nginx/nginx.conf